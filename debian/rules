#!/usr/bin/make -f
# -*- makefile -*-

export ROS_DISTRO=@ROS_DISTRO@
export ROS_PYTHON_VERSION:=$(shell . /opt/ros/${ROS_DISTRO}/setup.sh && echo $$ROS_PYTHON_VERSION)
ifeq (${ROS_PYTHON_VERSION}, 3)
	export PYTHONPATH:=/opt/ros/${ROS_DISTRO}/lib/python3/dist-packages:${PYTHONPATH}
else
	export PYTHONPATH:=/opt/ros/${ROS_DISTRO}/lib/python2.7/dist-packages:${PYTHONPATH}
endif
export PKG_CONFIG_PATH=/opt/ros/${ROS_DISTRO}/lib/pkgconfig:$PKG_CONFIG_PATH
export ROS_MASTER_URI=http://localhost:11311
export ROS_PACKAGE_PATH=/opt/ros/${ROS_DISTRO}/share
export CMAKE_PREFIX_PATH=/opt/ros/${ROS_DISTRO}:$CMAKE_PREFIX_PATH

# Disable assert() checking from upstream project, for best performance
# https://lists.debian.org/debian-med/2018/04/msg00132.html
export DEB_CFLAGS_MAINT_APPEND=-DNDEBUG
export DEB_CXXFLAGS_MAINT_APPEND=-DNDEBUG

%:
	dh $@ --parallel

# The data generated by this package is used in the tests but it cannot be accessed in the chroot
# Until we figure a better solution, testing is disabled
override_dh_autoconfigure:
	dh_autoconfigure -- -DBUILD_TESTING:BOOL=OFF

override_dh_shlibdeps:
	LD_LIBRARY_PATH="/opt/ros/${ROS_DISTRO}/lib:/opt/ros/${ROS_DISTRO}/lib/${DEB_TARGET_MULTIARCH}:${LD_LIBRARY_PATH}" dh_shlibdeps
